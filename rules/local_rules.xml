<!-- Local rules -->
<!-- Copyright (C) 2015, Wazuh Inc. -->

<group name="local,custom,ransomware_lockbit,phishing_silverterrier,">

  <!-- =================================================== -->
  <!-- Aturan untuk Skenario 1: Simulasi Ransomware LockBit 3.0 -->
  <!-- =================================================== -->

  <!-- Aturan 1: Mendeteksi Layanan VSS yang Dihentikan -->
  <rule id="100110" level="10">
    <if_sid>60703</if_sid>
    <description>LockBit 3.0 TTP: Layanan Volume Shadow Copy (VSS) dihentikan.</description>
    <mitre>
      <id>T1489</id>
    </mitre>
    <group>ransomware,impact,mitre_t1489,</group>
  </rule>

  <!-- Aturan 2: Mendeteksi Penghapusan Shadow Copy (vssadmin) -->
  <rule id="100111" level="12">
    <if_sid>61603</if_sid>
    <field name="data.win.eventdata.image" type="pcre2">(?i)vssadmin\.exe</field>
    <field name="data.win.eventdata.commandLine" type="pcre2">(?i)delete shadows</field>
    <description>LockBit 3.0 TTP: Shadow Copies dihapus menggunakan vssadmin.</description>
    <mitre>
      <id>T1490</id>
    </mitre>
    <group>ransomware,impact,mitre_t1490,</group>
  </rule>

  <!-- Aturan 3: Mendeteksi Pembersihan Event Log -->
  <rule id="100112" level="10">
    <if_sid>92032</if_sid>
    <match>wevtutil.exe</match>
    <match>cl Security</match>
    <description>LockBit 3.0 TTP: Event Log Keamanan dibersihkan menggunakan wevtutil.</description>
    <mitre>
      <id>T1070.001</id>
    </mitre>
    <group>ransomware,defense_evasion,mitre_t1070.001,</group>
  </rule>

  <!-- Aturan 4: Mendeteksi Perubahan Wallpaper Melalui Registry -->
  <rule id="100113" level="10">
    <if_sid>92041</if_sid>
    <match>Control Panel\Desktop /v Wallpaper</match>
    <description>LockBit 3.0 TTP: Wallpaper desktop diubah melalui registry.</description>
    <mitre>
      <id>T1491.001</id>
    </mitre>
    <group>ransomware,defacement,mitre_t1491.001,</group>
  </rule>

  <!-- =================================================== -->
  <!-- Aturan untuk Skenario 2: Simulasi Phishing dengan Dokumen -->
  <!-- =================================================== -->

  <rule id="100107" level="12">
    <if_sid>61603</if_sid>
    <field name="data.win.eventdata.image" type="pcre2">(?i)powershell\.exe</field>
    <field name="data.win.eventdata.parentImage" type="pcre2">(?i)WINWORD\.EXE</field>
    <description>Phishing/MalDoc TTP: PowerShell terdeteksi diluncurkan dari Microsoft Word.</description>
    <mitre>
      <id>T1566.001</id>
      <id>T1059.001</id>
    </mitre>
    <group>phishing,malicious_document,execution,mitre_t1566.001,mitre_t1059.001,</group>
  </rule>

</group>
